import {Blueprint, instantiate} from "../../common/game.js";
import {Quat, Vec3} from "../../common/math.js";
import {blueprint_box} from "../blueprints/blu_box.js";
import {blueprint_bush} from "../blueprints/blu_bush.js";
import {blueprint_exit} from "../blueprints/blu_exit.js";
import {blueprint_ground} from "../blueprints/blu_ground.js";
import {blueprint_obstacle_car} from "../blueprints/blu_obstacle_car.js";
import {blueprint_obstacle_house} from "../blueprints/blu_obstacle_house.js";
import {blueprint_ogon} from "../blueprints/blu_ogon.js";
import {blueprint_spawn_animal} from "../blueprints/blu_spawn_animal.js";
import {blueprint_spawn_bird} from "../blueprints/blu_spawn_bird.js";
import {blueprint_sun_light, blueprint_sun_shadow} from "../blueprints/blu_sun.js";
import {blueprint_tree} from "../blueprints/blu_tree.js";
import {transform} from "../components/com_transform.js";
import {Game} from "../game.js";
import {prop_car2} from "../props/prop_car2.js";
import {prop_house} from "../props/prop_house.js";
import {prop_slup} from "../props/prop_slup.js";

let transforms: Record<string, Array<[Vec3, Quat?, Vec3?]>> = {
    ground: [
        [
            [7.53, -0.5, 1.45],
            [0, 0.71, 0, 0.71],
            [4, 2, 30],
        ],
        [
            [30.68, -1.2, 1.45],
            [0, 0.71, 0, 0.71],
            [4, 2, 17.76],
        ],
        [
            [71.79, -1.48, 1.45],
            [0, 0.71, 0, 0.71],
            [4, 2, 6.11],
        ],
        [
            [76.04, 0.52, 1.45],
            [0, 0.71, 0, 0.71],
            [4, 2, 7.05],
        ],
        [
            [49.73, -1.5, -5.55],
            [0, 0.71, 0, 0.71],
            [10, 4, 120],
        ],
        [
            [53.76, -0.5, 1.45],
            [0, 0.71, 0, 0.71],
            [4, 2, 30],
        ],
    ],
    ogon: [
        [
            [17.04, -3.41, -6.36],
            [0, 0.71, 0, 0.71],
            [5, 10, 10],
        ],
        [
            [29.07, -2.85, -6.2],
            [0, 0.71, 0, 0.71],
            [5, 10, 10],
        ],
        [
            [40.24, -8.32, -7.02],
            [0, 0.71, 0, 0.71],
            [12, 22, 8],
        ],
        [
            [69.45, -3.41, -6.36],
            [0, 0.71, 0, 0.71],
            [5, 10, 10],
        ],
        [
            [87.09, -10.27, -7.02],
            [0, 0.71, 0, 0.71],
            [12, 22, 8],
        ],
    ],
    house: [
        [[11.67, 0.5, -2.49]],
        [
            [-1.9, 0.44, -3.7],
            [0, -0.99, 0, 0.17],
            [0.5, 0.5, 0.5],
        ],
        [
            [59.59, 0.44, -4.68],
            [0, 0.71, 0, 0.71],
            [0.5, 0.5, 0.5],
        ],
        [
            [61.26, 0.44, -4.68],
            [0, 0.71, 0, 0.71],
            [0.5, 0.5, 0.5],
        ],
        [
            [62.93, 0.44, -4.68],
            [0, 0.71, 0, 0.71],
            [0.5, 0.5, 0.5],
        ],
    ],
    bush: [
        [[8.58, 0.72, 0.59]],
        [[24.08, 0.38, -0.49]],
        [[0.56, 0.24, -3.39]],
        [[13.37, 2.13, -1.2]],
        [[-1.27, 0.19, -3.2], undefined, [0.5, 0.5, 0.5]],
        [[-4.52, 0.69, 1.75]],
        [[4.62, 0.53, -3.36]],
        [[26.94, 0.93, -1.8]],
        [[31.05, 0.74, -1.14]],
        [[29.08, 0.39, -3.85]],
        [[11.58, 0.68, 2.02]],
        [[22.34, 0.38, -0.91]],
        [[-2.77, 0.38, -0.99]],
        [[22.57, 0.93, -1.77]],
        [
            [42.7, 0.93, -2.99],
            [0, -0.73, 0, 0.69],
        ],
        [
            [60.15, 0.56, -3.88],
            [0, -0.73, 0, 0.69],
        ],
        [[67.32, 0.39, -3.85]],
        [[61.98, 0.21, 2.78]],
        [
            [56.16, 0.61, 0.39],
            [0, -1, 0, -0.02],
        ],
    ],
    slup: [
        [[2.69, 0.33, -2.79]],
        [[-0.62, 4.32, -5.26], undefined, [0.2, 0.2, 0.2]],
        [[-4.67, 3.78, -5.4], undefined, [0.15, 0.15, 0.15]],
        [[23.85, 0.11, -5.15]],
        [[21.29, 6.84, -5.26], undefined, [0.2, 0.2, 0.2]],
        [[15.39, 0.11, -2.79]],
        [[14.31, 0.11, 3.18]],
        [[56.12, 0.24, 2.71]],
        [[51.79, 4.32, -5.26], undefined, [0.2, 0.2, 0.2]],
        [[47.74, 3.78, -5.4], undefined, [0.15, 0.15, 0.15]],
        [
            [46, 0.11, -1.52],
            [0, -0.73, 0, 0.69],
        ],
        [[78.02, 0.24, -3.54]],
    ],
    tree: [
        [[-3.15, -0.07, -5.67]],
        [[11.68, 4.85, -5.24], undefined, [0.25, 0.25, 0.25]],
        [[20.6, 0.48, -2.51]],
        [[28.5, 0.48, -2.51]],
        [[30.33, 0.08, -3.08]],
        [[33.68, 0.26, -2.99]],
        [[33.43, 0.26, -4.45]],
        [[31.6, 0.26, -1.59]],
        [[29.48, 0.26, -0.83]],
        [[28.81, 0.26, -4.26]],
        [[34.24, 0.26, -5.09], undefined, [0.7, 0.7, 0.7]],
        [[32.34, 0.26, -3.38]],
        [[28.14, 0.26, -1.57]],
        [[27.83, 0.26, -4]],
        [[30.21, 0.26, -4.56]],
        [[30.57, 0.26, -2.24]],
        [[21.22, 0.26, -3.27]],
        [[22.44, 0.26, -2.85]],
        [[23.73, 0.26, -3.69]],
        [[17.43, 0.48, -2.71]],
        [[18.73, 0.48, -1.71]],
        [[30.87, 0.48, 3.1]],
        [[32.98, 0.48, 3.34]],
        [[33.51, 0.48, 3]],
        [[31.02, 0.26, -3.72]],
        [[31.78, 0.26, -4.74]],
        [[31.02, 0.26, -3.72]],
        [[31.78, 0.26, -4.74]],
        [[34.23, 0.26, -5.69], undefined, [0.7, 0.7, 0.7]],
        [[37.32, 0.26, -6], undefined, [0.7, 0.7, 0.7]],
        [[34.82, 0.26, -6.02], undefined, [0.7, 0.7, 0.7]],
        [[34.69, 0.26, -5.57], undefined, [0.7, 0.7, 0.7]],
        [[35.66, 0.26, -6.28], undefined, [0.7, 0.7, 0.7]],
        [[35.34, 0.26, -5.68], undefined, [0.7, 0.7, 0.7]],
        [[36.18, 0.26, -5.88], undefined, [0.7, 0.7, 0.7]],
        [[38.56, 0.26, -6.61], undefined, [0.4, 0.4, 0.4]],
        [[36.27, 0.26, -6.53], undefined, [0.4, 0.4, 0.4]],
        [[36.88, 0.26, -7.02], undefined, [0.4, 0.4, 0.4]],
        [[37.91, 0.26, -6.46], undefined, [0.4, 0.4, 0.4]],
        [[37.39, 0.26, -6.92], undefined, [0.4, 0.4, 0.4]],
        [[37.06, 0.26, -6.53], undefined, [0.4, 0.4, 0.4]],
        [[38.19, 0.26, -6.96], undefined, [0.4, 0.4, 0.4]],
        [
            [44.27, 0.26, -4.25],
            [0, -0.73, 0, 0.69],
        ],
        [
            [43.78, 0.26, -3.06],
            [0, -0.73, 0, 0.69],
        ],
        [[68.57, 0.08, -3.08]],
        [[71.92, 0.26, -2.99]],
        [[71.67, 0.26, -4.45]],
        [[72.48, 0.26, -5.09], undefined, [0.7, 0.7, 0.7]],
        [[70.58, 0.26, -3.38]],
        [[68.81, 0.26, -2.24]],
        [[69.26, 0.26, -3.72]],
        [[70.02, 0.26, -4.74]],
        [[72.47, 0.26, -5.69], undefined, [0.7, 0.7, 0.7]],
        [
            [78.66, 1.21, 3.1],
            [0, 1, 0, 0.09],
        ],
        [
            [75.15, 1.4, -0.34],
            [0, 1, 0, 0.09],
        ],
        [
            [73.43, 1.23, 3.11],
            [0, 1, 0, 0.09],
        ],
    ],
    obstacle_house: [[[11.69, 0.5, 0.83]], [[54.04, 0.5, 0.83]]],
    obstacle_car: [
        [
            [-3.95, 0.5, 1.41],
            [0, 0.62, 0, 0.78],
        ],
        [
            [7.69, 1, -0.1],
            [-0.15, 0.68, 0.7, 0.14],
            [0.4, 0.4, 0.4],
        ],
        [
            [56.4, 1, 0.3],
            [0.7, 0.15, 0.16, -0.68],
        ],
    ],
    box: [
        [[28.61, 0.97, 0]],
        [[54.23, 4.09, 0]],
        [[28.61, 2.41, 0]],
        [[41.7, 2.41, 0]],
        [[41.39, 2.41, 2.85]],
        [
            [41.03, 2.95, -1.3],
            [0, 0, -0.71, 0.71],
        ],
    ],
    car2: [
        [
            [21.96, 1, -2.35],
            [-0.44, 0.55, 0.56, 0.43],
            [0.4, 0.4, 0.4],
        ],
        [
            [43.31, 1, -3.57],
            [-0.71, 0.06, 0.06, 0.7],
            [0.4, 0.4, 0.4],
        ],
    ],
    exit: [[[77, 1.5, 0]]],
    spawn_bird: [
        [
            [-3, 2, -2],
            [0.01, 0.76, 0.12, 0.64],
        ],
        [
            [14, 2, -2],
            [0.01, 0.76, 0.12, 0.64],
        ],
        [
            [33, 2, -2],
            [0.01, 0.76, 0.12, 0.64],
        ],
        [
            [53, 2, -2],
            [0.01, 0.76, 0.12, 0.64],
        ],
        [
            [73, 2, -2],
            [0.01, 0.76, 0.12, 0.64],
        ],
    ],
    spawn_animal: [
        [
            [-7, 0.5, -5],
            [0, 0.71, 0, 0.71],
        ],
    ],
};

let blueprints: Record<string, (game: Game) => Blueprint<Game>> = {
    ground: blueprint_ground,
    ogon: blueprint_ogon,
    house: prop_house,
    bush: blueprint_bush,
    slup: prop_slup,
    tree: blueprint_tree,
    obstacle_house: blueprint_obstacle_house,
    obstacle_car: blueprint_obstacle_car,
    box: blueprint_box,
    car2: prop_car2,
    exit: blueprint_exit,
    spawn_bird: blueprint_spawn_bird,
    spawn_animal: blueprint_spawn_animal,
};

export function map_city(game: Game) {
    instantiate(game, [...blueprint_sun_light(game), transform()]);

    instantiate(game, [...blueprint_sun_shadow(game), transform()]);

    for (let key of Object.keys(transforms)) {
        let blueprint = blueprints[key];
        for (let i = 0; i < transforms[key].length; i++) {
            instantiate(game, [
                transform(transforms[key][i][0], transforms[key][i][1], transforms[key][i][2]),
                ...blueprint(game),
            ]);
        }
    }
}
